DELETE FROM EVENT_CONFIGURATION WHERE uuid = 'b0c0867b-d2b9-4ba4-8feb-b8d20147addd';

INSERT INTO EVENT_CONFIGURATION(created_by, created_on, modified_by, modified_on, day, description, event_type, event_type_detail_id, form_type_id, hour, minute, name, config_json, state, trigger_when, event_type_detail_code, uuid)
VALUES (
1,  current_date , 1,  current_date , null, null, 'FORM_SUBMITTED', null, 2, null, null, 'ANC_config', '[{"query":"select\n\trch_anc_master.id,\n\trch_anc_master.member_id,\n\timt_family.id as family_id,\n\trch_anc_master.is_from_web,\n\t(\n\t\tcase\n\t\t\twhen imt_family.area_id is null then imt_family.location_id\n\t\t\telse cast(imt_family.area_id as integer)\n\t\tend\n\t) as location_id,\n\t(\n\t\tselect\n\t\t\tid\n\t\tfrom\n\t\t\tlocation_level_hierarchy_master\n\t\twhere\n\t\t\tlocation_id = (\n\t\t\t\tcase\n\t\t\t\t\twhen imt_family.area_id is null then imt_family.location_id\n\t\t\t\t\telse cast(imt_family.area_id as integer)\n\t\t\t\tend\n\t\t\t)\n\t) as location_hierarchy_id,\n\ttecho_notification_master.id as notification_id,\n\trch_anc_master.member_status,\n\trch_anc_master.created_by as created_by,\n\trch_anc_master.haemoglobin_count,\n\trch_anc_master.is_high_risk_case,\n\trch_anc_master.blood_group,\n\trch_anc_master.weight,\n\trch_anc_master.last_delivery_outcome,\n\tto_char(\n\t\t(\n\t\t\tcase\n\t\t\t\twhen rch_anc_master.lmp is null then imt_member.lmp\n\t\t\t\telse rch_anc_master.lmp\n\t\t\tend + interval ''1'' day * 281\n\t\t),\n\t\t''MM/DD/YYYY''\n\t) as edd,\n\tto_char(death_date, ''MM/DD/YYYY'') as death_date,\n\tdeath_reason,\n\tplace_of_death,\n\tdeath_infra_id,\n\tcast(null as text) as other_death_reason,\n\tto_char(rch_anc_master.lmp, ''MM/DD/YYYY'') as last_lmp_date,\n\timt_member.cur_preg_reg_det_id,\n\trch_anc_master.pregnancy_reg_det_id,\n\tcase\n\t\twhen rch_anc_master.service_date is null then to_char(current_date, ''DD/MM/YYYY'')\n\t\telse to_char(rch_anc_master.service_date, ''DD/MM/YYYY'')\n\tend as service_date,\n\tto_char(\n\t\trch_anc_master.iron_def_anemia_inj_due_date,\n\t\t''MM/DD/YYYY''\n\t) as iron_sucrose_due_date,\n\tto_char(tt1.given_on, ''MM/DD/YYYY'') as tt1_given_date,\n\tto_char(tt2.given_on, ''MM/DD/YYYY'') as tt2_given_date,\n\tcase\n\t\twhen emnp.id is null then false\n\t\telse true\n\tend as tt2_event_configured,\n\ttt2_alert.id as tt2_alert_id\nfrom\n\trch_anc_master\n\tinner join imt_member on rch_anc_master.member_id = imt_member.id\n\tinner join imt_family on imt_family.family_id = imt_member.family_id\n\tleft join techo_notification_master on techo_notification_master.member_id = rch_anc_master.member_id\n\tand techo_notification_master.notification_type_id = 2\n\tand techo_notification_master.state in (''PENDING'', ''RESCHEDULE'')\n\tleft join rch_immunisation_master tt1 on tt1.member_id = rch_anc_master.member_id\n\tand tt1.pregnancy_reg_det_id = rch_anc_master.pregnancy_reg_det_id\n\tand tt1.immunisation_given = ''TT1''\n\tleft join rch_immunisation_master tt2 on tt2.member_id = rch_anc_master.member_id\n\tand tt2.pregnancy_reg_det_id = rch_anc_master.pregnancy_reg_det_id\n\tand tt2.immunisation_given = ''TT2''\n\tleft join event_mobile_notification_pending emnp on emnp.member_id = rch_anc_master.member_id\n\tand emnp.state = ''PENDING''\n\tand emnp.notification_configuration_type_id = (\n\t\tselect\n\t\t\tid\n\t\tfrom\n\t\t\tevent_configuration_type\n\t\twhere\n\t\t\tmobile_notification_type = (\n\t\t\t\tselect\n\t\t\t\t\tid\n\t\t\t\tfrom\n\t\t\t\t\tnotification_type_master\n\t\t\t\twhere\n\t\t\t\t\tcode = ''TT2_ALERT''\n\t\t\t)\n\t)\n\tleft join techo_notification_master tt2_alert on tt2_alert.member_id = rch_anc_master.member_id\n\tand tt2_alert.state = ''PENDING''\n\tand tt2_alert.notification_type_id = (\n\t\tselect\n\t\t\tid\n\t\tfrom\n\t\t\tnotification_type_master\n\t\twhere\n\t\t\tcode = ''TT2_ALERT''\n\t)\nwhere\n\trch_anc_master.id = #resourceId# limit 1;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"''#member_status#'' == ''DEATH''","conditionParam":"member_status","description":null,"notificaitonConfigsType":[{"id":"50c8d1d9-5b30-4d52-bf13-7d39243c27eb","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":56,"queryCode":"mark_member_as_death","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"location_hierarchy_id","mappingValue":"location_hierarchy_id","isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"service_type","mappingValue":"FHW_ANC","isFixed":true},{"parameterName":"reference_id","mappingValue":"id","isFixed":false},{"parameterName":"death_reason","mappingValue":"death_reason","isFixed":false},{"parameterName":"other_death_reason","mappingValue":"other_death_reason","isFixed":false},{"parameterName":"place_of_death","mappingValue":"place_of_death","isFixed":false},{"parameterName":"location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"death_date","mappingValue":"death_date","isFixed":false},{"parameterName":"health_infra_id","mappingValue":"death_infra_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"75bf1f30-d589-4f37-a866-1c1436fe3631","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#notification_id#'' == ''null'' && ''#member_status#'' == ''AVAILABLE'' && (''#is_from_web#'' == ''null'' || #is_from_web# == false)","conditionParam":"is_from_web,member_status,notification_id","description":null,"notificaitonConfigsType":[{"id":"5d884ebb-f202-4011-8e72-1f4814797473","type":"QUERY","template":"update techo_notification_master set state = ''COMPLETED'' , action_by = #created_by# \nwhere member_id = #member_id# and state in (''PENDING'',''RESCHEDULE'')  and notification_type_id = (select id from notification_type_master where code = ''FHW_ANC'');","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#notification_id#'' !== ''null'' && ''#member_status#'' == ''AVAILABLE''","conditionParam":"member_status,notification_id","description":null,"notificaitonConfigsType":[{"id":"1daab3d9-98b6-4267-949d-15e577a5ec03","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#member_status#'' == ''WRONGLY_REGISTERED''","conditionParam":"member_status","description":null,"notificaitonConfigsType":[{"id":"30293ed6-8f45-41d2-8aec-bc97b65a551f","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":54,"queryCode":"mark_as_wrongly_pregnancy_mark","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"normal_cycle_days","mappingValue":"normal_cycle_days","isFixed":false},{"parameterName":"last_lmp_date","mappingValue":"last_lmp_date","isFixed":false},{"parameterName":"pregnancy_reg_det_id","mappingValue":"pregnancy_reg_det_id","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"bbc08f94-cc1b-4e6c-be8e-aebaafd50f8c","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#last_lmp_date#'' != ''null'' || ''#edd#'' != ''null'' || #weight# != null || ''#blood_group#'' != ''null'' || #haemoglobin_count# != null || #is_high_risk_case# != null || ''#last_delivery_outcome#'' != ''null''","conditionParam":"is_high_risk_case,edd,last_delivery_outcome,weight,blood_group,haemoglobin_count,last_lmp_date","description":null,"notificaitonConfigsType":[{"id":"2217c524-4f2b-4f05-9053-7b4ec3fb21dc","type":"QUERY","template":"update\n\timt_member\nset\n\tanc_visit_dates = concat(\n\t\t(\n\t\t\tcase\n\t\t\t\twhen anc_visit_dates is not null then concat(anc_visit_dates, '','')\n\t\t\t\telse null\n\t\t\tend\n\t\t),\n\t\t''#service_date#''\n\t),\n\tlmp = case\n\t\twhen ''#last_lmp_date#'' = ''null'' then imt_member.lmp\n\t\telse cast(\n\t\t\t(\n\t\t\t\tcase\n\t\t\t\t\twhen ''#last_lmp_date#'' = ''null'' then null\n\t\t\t\t\telse ''#last_lmp_date#''\n\t\t\t\tend\n\t\t\t) as date\n\t\t)\n\tend,\n\tedd = case\n\t\twhen ''#edd#'' = ''null'' then imt_member.edd\n\t\telse cast(\n\t\t\t(\n\t\t\t\tcase\n\t\t\t\t\twhen ''#edd#'' = ''null'' then null\n\t\t\t\t\telse ''#edd#''\n\t\t\t\tend\n\t\t\t) as date\n\t\t)\n\tend,\n\tearly_registration = (\n\t\t(\n\t\t\tcase\n\t\t\t\twhen ''#last_lmp_date#'' = ''null'' then imt_member.lmp\n\t\t\t\telse cast(\n\t\t\t\t\t(\n\t\t\t\t\t\tcase\n\t\t\t\t\t\t\twhen ''#last_lmp_date#'' = ''null'' then null\n\t\t\t\t\t\t\telse ''#last_lmp_date#''\n\t\t\t\t\t\tend\n\t\t\t\t\t) as date\n\t\t\t\t)\n\t\t\tend\n\t\t) + 100 * INTERVAL ''1 day''\n\t) >= now(),\n\tweight = (\n\t\tcase\n\t\t\twhen #weight# is not null then #weight# else imt_member.weight end), \n\t\t\tblood_group = (\n\t\t\t\tcase\n\t\t\t\t\twhen ''#blood_group#'' != ''null'' then ''#blood_group#''\n\t\t\t\t\telse imt_member.blood_group\n\t\t\t\tend\n\t\t\t),\n\t\t\t\t\tis_high_risk_case = case\n\t\t\t\t\t\twhen #is_high_risk_case# is not null and #is_high_risk_case# = true then #is_high_risk_case# else imt_member.is_high_risk_case end, \n\t\t\t\t\t\thaemoglobin = case\n\t\t\t\t\t\t\twhen #haemoglobin_count# is not null then #haemoglobin_count# else imt_member.haemoglobin end, \n\t\t\t\t\t\t\tlast_delivery_outcome = case\n\t\t\t\t\t\t\t\twhen ''#last_delivery_outcome#'' != ''null'' then ''#last_delivery_outcome#''\n\t\t\t\t\t\t\t\telse imt_member.last_delivery_outcome\n\t\t\t\t\t\t\tend,\n\t\t\t\t\t\t\tmodified_on = now(),\n\t\t\t\t\t\t\tmodified_by = #created_by# where id = #member_id#;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,is_high_risk_case,edd,service_date,last_delivery_outcome,weight,blood_group,haemoglobin_count,last_lmp_date,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#last_lmp_date#'' != ''null'' && ''#member_status#'' != ''WRONGLY_REGISTERED''","conditionParam":"member_status,last_lmp_date","description":null,"notificaitonConfigsType":[{"id":"c8002440-07ae-4b5b-b9b3-f488eb41264d","type":"QUERY","template":"update rch_pregnancy_registration_det set lmp_date = ''#last_lmp_date#'', edd = (cast(''#last_lmp_date#'' as date) + interval ''1'' day * 281), modified_on = now(), modified_by = #created_by#  where id = #pregnancy_reg_det_id#;\nupdate event_mobile_notification_pending set base_date = ''#last_lmp_date#'', modified_on = now(), modified_by = #created_by#  where member_id = #member_id#  and notification_configuration_type_id in (''5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a'',''faedb8e7-3e46-40a2-a9ac-ea7d5de944fa'') and ref_code = #pregnancy_reg_det_id#;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,last_lmp_date,created_by,pregnancy_reg_det_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#pregnancy_reg_det_id#'' == ''null'' || ''#pregnancy_reg_det_id#'' == ''-1''","conditionParam":"pregnancy_reg_det_id","description":null,"notificaitonConfigsType":[{"id":"fbe31e48-ade3-441f-8e4c-391a00f4cee2","type":"QUERY","template":"update rch_anc_master set pregnancy_reg_det_id = #cur_preg_reg_det_id# where id = #id#","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"cur_preg_reg_det_id,id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#tt1_given_date#'' != ''null'' && ''#tt2_given_date#'' == ''null'' && #tt2_event_configured# == false && #tt2_alert_id# == null","conditionParam":"tt1_given_date,tt2_given_date,tt2_event_configured,tt2_alert_id","description":"This will generate the TT2 alert for the beneficiary","notificaitonConfigsType":[{"id":"45056772-3000-40ea-926c-a63a4f140e38","type":"MOBILE","template":null,"mobileNotificationType":35,"mobileNotificationTypeUUID":"cb251690-e755-4e6f-aacd-32deccb13b79","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"tt1_given_date","refCode":"pregnancy_reg_det_id","memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"e2b029c3-65e6-48f7-a1c7-15e33bd32d97","notificationCode":"0","numberOfDaysAddedForOnDate":28,"numberOfDaysAddedForDueDate":31,"numberOfDaysAddedForExpiryDate":null,"notificationTypeConfigId":"45056772-3000-40ea-926c-a63a4f140e38"}],"configId":19,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#tt2_given_date#'' != ''null'' && #tt2_alert_id# != null","conditionParam":"tt2_given_date,tt2_alert_id","description":null,"notificaitonConfigsType":[{"id":"522984cd-ccc4-4efb-84e8-ded121c6b2bd","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":null,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"tt2_alert_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#iron_sucrose_due_date#'' != ''null''","conditionParam":"iron_sucrose_due_date","description":null,"notificaitonConfigsType":[{"id":"a2cd5671-beda-4e6d-a355-5f1b107369c7","type":"MOBILE","template":null,"mobileNotificationType":36,"mobileNotificationTypeUUID":"99d837e9-3df4-4dc9-aafc-b84660d8b066","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"iron_sucrose_due_date","refCode":"pregnancy_reg_det_id","memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"0e41aa0f-d0b0-47c4-ab65-e4fdbe1c07a3","notificationCode":"0","numberOfDaysAddedForOnDate":0,"numberOfDaysAddedForDueDate":3,"numberOfDaysAddedForExpiryDate":null,"notificationTypeConfigId":"a2cd5671-beda-4e6d-a355-5f1b107369c7"}],"configId":19,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]}]', 'ACTIVE', null, null, 'b0c0867b-d2b9-4ba4-8feb-b8d20147addd');

DELETE FROM EVENT_CONFIGURATION_TYPE WHERE event_config_uuid ='b0c0867b-d2b9-4ba4-8feb-b8d20147addd';

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'50c8d1d9-5b30-4d52-bf13-7d39243c27eb', null, 'b0c0867b-d2b9-4ba4-8feb-b8d20147addd', null, null, null, null, null, null, null, null, 'IMMEDIATELY', 'QUERY', null, null, null, 56, '[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"location_hierarchy_id","mappingValue":"location_hierarchy_id","isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"service_type","mappingValue":"FHW_ANC","isFixed":true},{"parameterName":"reference_id","mappingValue":"id","isFixed":false},{"parameterName":"death_reason","mappingValue":"death_reason","isFixed":false},{"parameterName":"other_death_reason","mappingValue":"other_death_reason","isFixed":false},{"parameterName":"place_of_death","mappingValue":"place_of_death","isFixed":false},{"parameterName":"location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"death_date","mappingValue":"death_date","isFixed":false},{"parameterName":"health_infra_id","mappingValue":"death_infra_id","isFixed":false}]', 'mark_member_as_death', null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'75bf1f30-d589-4f37-a866-1c1436fe3631', null, 'b0c0867b-d2b9-4ba4-8feb-b8d20147addd', null, null, null, null, null, null, null, null, 'IMMEDIATELY', 'QUERY', null, null, null, 53, '[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}]', 'mob_notification_mark_as_complete', null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'5d884ebb-f202-4011-8e72-1f4814797473', null, 'b0c0867b-d2b9-4ba4-8feb-b8d20147addd', null, null, null, null, null, null, 'update techo_notification_master set state = ''COMPLETED'' , action_by = #created_by#
where member_id = #member_id# and state in (''PENDING'',''RESCHEDULE'')  and notification_type_id = (select id from notification_type_master where code = ''FHW_ANC'');', 'member_id,created_by', 'IMMEDIATELY', 'QUERY', null, null, null, null, null, null, null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'1daab3d9-98b6-4267-949d-15e577a5ec03', null, 'b0c0867b-d2b9-4ba4-8feb-b8d20147addd', null, null, null, null, null, null, null, null, 'IMMEDIATELY', 'QUERY', null, null, null, 53, '[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}]', 'mob_notification_mark_as_complete', null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'30293ed6-8f45-41d2-8aec-bc97b65a551f', null, 'b0c0867b-d2b9-4ba4-8feb-b8d20147addd', null, null, null, null, null, null, null, null, 'IMMEDIATELY', 'QUERY', null, null, null, 54, '[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"normal_cycle_days","mappingValue":"normal_cycle_days","isFixed":false},{"parameterName":"last_lmp_date","mappingValue":"last_lmp_date","isFixed":false},{"parameterName":"pregnancy_reg_det_id","mappingValue":"pregnancy_reg_det_id","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false}]', 'mark_as_wrongly_pregnancy_mark', null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'bbc08f94-cc1b-4e6c-be8e-aebaafd50f8c', null, 'b0c0867b-d2b9-4ba4-8feb-b8d20147addd', null, null, null, null, null, null, null, null, 'IMMEDIATELY', 'QUERY', null, null, null, 53, '[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}]', 'mob_notification_mark_as_complete', null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'2217c524-4f2b-4f05-9053-7b4ec3fb21dc', null, 'b0c0867b-d2b9-4ba4-8feb-b8d20147addd', null, null, null, null, null, null, 'update
	imt_member
set
	anc_visit_dates = concat(
		(
			case
				when anc_visit_dates is not null then concat(anc_visit_dates, '','')
				else null
			end
		),
		''#service_date#''
	),
	lmp = case
		when ''#last_lmp_date#'' = ''null'' then imt_member.lmp
		else cast(
			(
				case
					when ''#last_lmp_date#'' = ''null'' then null
					else ''#last_lmp_date#''
				end
			) as date
		)
	end,
	edd = case
		when ''#edd#'' = ''null'' then imt_member.edd
		else cast(
			(
				case
					when ''#edd#'' = ''null'' then null
					else ''#edd#''
				end
			) as date
		)
	end,
	early_registration = (
		(
			case
				when ''#last_lmp_date#'' = ''null'' then imt_member.lmp
				else cast(
					(
						case
							when ''#last_lmp_date#'' = ''null'' then null
							else ''#last_lmp_date#''
						end
					) as date
				)
			end
		) + 100 * INTERVAL ''1 day''
	) >= now(),
	weight = (
		case
			when #weight# is not null then #weight# else imt_member.weight end),
			blood_group = (
				case
					when ''#blood_group#'' != ''null'' then ''#blood_group#''
					else imt_member.blood_group
				end
			),
					is_high_risk_case = case
						when #is_high_risk_case# is not null and #is_high_risk_case# = true then #is_high_risk_case# else imt_member.is_high_risk_case end,
						haemoglobin = case
							when #haemoglobin_count# is not null then #haemoglobin_count# else imt_member.haemoglobin end,
							last_delivery_outcome = case
								when ''#last_delivery_outcome#'' != ''null'' then ''#last_delivery_outcome#''
								else imt_member.last_delivery_outcome
							end,
							modified_on = now(),
							modified_by = #created_by# where id = #member_id#;', 'member_id,is_high_risk_case,edd,service_date,last_delivery_outcome,weight,blood_group,haemoglobin_count,last_lmp_date,created_by', 'IMMEDIATELY', 'QUERY', null, null, null, null, null, null, null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'c8002440-07ae-4b5b-b9b3-f488eb41264d', null, 'b0c0867b-d2b9-4ba4-8feb-b8d20147addd', null, null, null, null, null, null, 'update rch_pregnancy_registration_det set lmp_date = ''#last_lmp_date#'', edd = (cast(''#last_lmp_date#'' as date) + interval ''1'' day * 281), modified_on = now(), modified_by = #created_by#  where id = #pregnancy_reg_det_id#;
update event_mobile_notification_pending set base_date = ''#last_lmp_date#'', modified_on = now(), modified_by = #created_by#  where member_id = #member_id#  and notification_configuration_type_id in (''5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a'',''faedb8e7-3e46-40a2-a9ac-ea7d5de944fa'') and ref_code = #pregnancy_reg_det_id#;', 'member_id,last_lmp_date,created_by,pregnancy_reg_det_id', 'IMMEDIATELY', 'QUERY', null, null, null, null, null, null, null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'fbe31e48-ade3-441f-8e4c-391a00f4cee2', null, 'b0c0867b-d2b9-4ba4-8feb-b8d20147addd', null, null, null, null, null, null, 'update rch_anc_master set pregnancy_reg_det_id = #cur_preg_reg_det_id# where id = #id#', 'cur_preg_reg_det_id,id', 'IMMEDIATELY', 'QUERY', null, null, null, null, null, null, null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'45056772-3000-40ea-926c-a63a4f140e38', 'tt1_given_date', 'b0c0867b-d2b9-4ba4-8feb-b8d20147addd', null, null, null, null, null, 35, null, null, null, 'MOBILE', null, 'family_id', 'member_id', null, null, null, null, null);

DELETE FROM EVENT_MOBILE_CONFIGURATION WHERE notification_type_config_id ='45056772-3000-40ea-926c-a63a4f140e38';

INSERT INTO EVENT_MOBILE_CONFIGURATION(id, notification_code, notification_type_config_id, number_of_days_added_for_due_date, number_of_days_added_for_expiry_date, number_of_days_added_for_on_date)
VALUES (
'e2b029c3-65e6-48f7-a1c7-15e33bd32d97', '0', '45056772-3000-40ea-926c-a63a4f140e38', 31, null, 28);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'522984cd-ccc4-4efb-84e8-ded121c6b2bd', null, 'b0c0867b-d2b9-4ba4-8feb-b8d20147addd', null, null, null, null, null, null, null, null, 'IMMEDIATELY', 'QUERY', null, null, null, null, '[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"tt2_alert_id","isFixed":false}]', 'mob_notification_mark_as_complete', null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'a2cd5671-beda-4e6d-a355-5f1b107369c7', 'iron_sucrose_due_date', 'b0c0867b-d2b9-4ba4-8feb-b8d20147addd', null, null, null, null, null, 36, null, null, null, 'MOBILE', null, 'family_id', 'member_id', null, null, null, null, null);

DELETE FROM EVENT_MOBILE_CONFIGURATION WHERE notification_type_config_id ='a2cd5671-beda-4e6d-a355-5f1b107369c7';

INSERT INTO EVENT_MOBILE_CONFIGURATION(id, notification_code, notification_type_config_id, number_of_days_added_for_due_date, number_of_days_added_for_expiry_date, number_of_days_added_for_on_date)
VALUES (
'0e41aa0f-d0b0-47c4-ab65-e4fdbe1c07a3', '0', 'a2cd5671-beda-4e6d-a355-5f1b107369c7', 3, null, 0);

INSERT INTO SYNC_SYSTEM_CONFIGURATION_MASTER(feature_type, config_json, created_on, created_by, feature_uuid, feature_name)
VALUES (
'EVENT_BUILDER', '{"id":19,"name":"ANC_config","description":null,"eventType":"FORM_SUBMITTED","eventTypeDetailId":null,"formTypeId":2,"eventTypeDetailCode":null,"trigerWhen":null,"day":null,"hour":null,"minute":null,"state":"ACTIVE","createdBy":1,"createdOn":1719232738761,"notificationConfigDetails":[{"query":"select\n\trch_anc_master.id,\n\trch_anc_master.member_id,\n\timt_family.id as family_id,\n\trch_anc_master.is_from_web,\n\t(\n\t\tcase\n\t\t\twhen imt_family.area_id is null then imt_family.location_id\n\t\t\telse cast(imt_family.area_id as integer)\n\t\tend\n\t) as location_id,\n\t(\n\t\tselect\n\t\t\tid\n\t\tfrom\n\t\t\tlocation_level_hierarchy_master\n\t\twhere\n\t\t\tlocation_id = (\n\t\t\t\tcase\n\t\t\t\t\twhen imt_family.area_id is null then imt_family.location_id\n\t\t\t\t\telse cast(imt_family.area_id as integer)\n\t\t\t\tend\n\t\t\t)\n\t) as location_hierarchy_id,\n\ttecho_notification_master.id as notification_id,\n\trch_anc_master.member_status,\n\trch_anc_master.created_by as created_by,\n\trch_anc_master.haemoglobin_count,\n\trch_anc_master.is_high_risk_case,\n\trch_anc_master.blood_group,\n\trch_anc_master.weight,\n\trch_anc_master.last_delivery_outcome,\n\tto_char(\n\t\t(\n\t\t\tcase\n\t\t\t\twhen rch_anc_master.lmp is null then imt_member.lmp\n\t\t\t\telse rch_anc_master.lmp\n\t\t\tend + interval ''1'' day * 281\n\t\t),\n\t\t''MM/DD/YYYY''\n\t) as edd,\n\tto_char(death_date, ''MM/DD/YYYY'') as death_date,\n\tdeath_reason,\n\tplace_of_death,\n\tdeath_infra_id,\n\tcast(null as text) as other_death_reason,\n\tto_char(rch_anc_master.lmp, ''MM/DD/YYYY'') as last_lmp_date,\n\timt_member.cur_preg_reg_det_id,\n\trch_anc_master.pregnancy_reg_det_id,\n\tcase\n\t\twhen rch_anc_master.service_date is null then to_char(current_date, ''DD/MM/YYYY'')\n\t\telse to_char(rch_anc_master.service_date, ''DD/MM/YYYY'')\n\tend as service_date,\n\tto_char(\n\t\trch_anc_master.iron_def_anemia_inj_due_date,\n\t\t''MM/DD/YYYY''\n\t) as iron_sucrose_due_date,\n\tto_char(tt1.given_on, ''MM/DD/YYYY'') as tt1_given_date,\n\tto_char(tt2.given_on, ''MM/DD/YYYY'') as tt2_given_date,\n\tcase\n\t\twhen emnp.id is null then false\n\t\telse true\n\tend as tt2_event_configured,\n\ttt2_alert.id as tt2_alert_id\nfrom\n\trch_anc_master\n\tinner join imt_member on rch_anc_master.member_id = imt_member.id\n\tinner join imt_family on imt_family.family_id = imt_member.family_id\n\tleft join techo_notification_master on techo_notification_master.member_id = rch_anc_master.member_id\n\tand techo_notification_master.notification_type_id = 2\n\tand techo_notification_master.state in (''PENDING'', ''RESCHEDULE'')\n\tleft join rch_immunisation_master tt1 on tt1.member_id = rch_anc_master.member_id\n\tand tt1.pregnancy_reg_det_id = rch_anc_master.pregnancy_reg_det_id\n\tand tt1.immunisation_given = ''TT1''\n\tleft join rch_immunisation_master tt2 on tt2.member_id = rch_anc_master.member_id\n\tand tt2.pregnancy_reg_det_id = rch_anc_master.pregnancy_reg_det_id\n\tand tt2.immunisation_given = ''TT2''\n\tleft join event_mobile_notification_pending emnp on emnp.member_id = rch_anc_master.member_id\n\tand emnp.state = ''PENDING''\n\tand emnp.notification_configuration_type_id = (\n\t\tselect\n\t\t\tid\n\t\tfrom\n\t\t\tevent_configuration_type\n\t\twhere\n\t\t\tmobile_notification_type = (\n\t\t\t\tselect\n\t\t\t\t\tid\n\t\t\t\tfrom\n\t\t\t\t\tnotification_type_master\n\t\t\t\twhere\n\t\t\t\t\tcode = ''TT2_ALERT''\n\t\t\t)\n\t)\n\tleft join techo_notification_master tt2_alert on tt2_alert.member_id = rch_anc_master.member_id\n\tand tt2_alert.state = ''PENDING''\n\tand tt2_alert.notification_type_id = (\n\t\tselect\n\t\t\tid\n\t\tfrom\n\t\t\tnotification_type_master\n\t\twhere\n\t\t\tcode = ''TT2_ALERT''\n\t)\nwhere\n\trch_anc_master.id = #resourceId# limit 1;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"''#member_status#'' == ''DEATH''","conditionParam":"member_status","description":null,"notificaitonConfigsType":[{"id":"50c8d1d9-5b30-4d52-bf13-7d39243c27eb","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":56,"queryCode":"mark_member_as_death","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"location_hierarchy_id","mappingValue":"location_hierarchy_id","isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"service_type","mappingValue":"FHW_ANC","isFixed":true},{"parameterName":"reference_id","mappingValue":"id","isFixed":false},{"parameterName":"death_reason","mappingValue":"death_reason","isFixed":false},{"parameterName":"other_death_reason","mappingValue":"other_death_reason","isFixed":false},{"parameterName":"place_of_death","mappingValue":"place_of_death","isFixed":false},{"parameterName":"location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"death_date","mappingValue":"death_date","isFixed":false},{"parameterName":"health_infra_id","mappingValue":"death_infra_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"75bf1f30-d589-4f37-a866-1c1436fe3631","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#notification_id#'' == ''null'' && ''#member_status#'' == ''AVAILABLE'' && (''#is_from_web#'' == ''null'' || #is_from_web# == false)","conditionParam":"is_from_web,member_status,notification_id","description":null,"notificaitonConfigsType":[{"id":"5d884ebb-f202-4011-8e72-1f4814797473","type":"QUERY","template":"update techo_notification_master set state = ''COMPLETED'' , action_by = #created_by# \nwhere member_id = #member_id# and state in (''PENDING'',''RESCHEDULE'')  and notification_type_id = (select id from notification_type_master where code = ''FHW_ANC'');","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#notification_id#'' !== ''null'' && ''#member_status#'' == ''AVAILABLE''","conditionParam":"member_status,notification_id","description":null,"notificaitonConfigsType":[{"id":"1daab3d9-98b6-4267-949d-15e577a5ec03","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#member_status#'' == ''WRONGLY_REGISTERED''","conditionParam":"member_status","description":null,"notificaitonConfigsType":[{"id":"30293ed6-8f45-41d2-8aec-bc97b65a551f","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":54,"queryCode":"mark_as_wrongly_pregnancy_mark","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"normal_cycle_days","mappingValue":"normal_cycle_days","isFixed":false},{"parameterName":"last_lmp_date","mappingValue":"last_lmp_date","isFixed":false},{"parameterName":"pregnancy_reg_det_id","mappingValue":"pregnancy_reg_det_id","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"bbc08f94-cc1b-4e6c-be8e-aebaafd50f8c","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#last_lmp_date#'' != ''null'' || ''#edd#'' != ''null'' || #weight# != null || ''#blood_group#'' != ''null'' || #haemoglobin_count# != null || #is_high_risk_case# != null || ''#last_delivery_outcome#'' != ''null''","conditionParam":"is_high_risk_case,edd,last_delivery_outcome,weight,blood_group,haemoglobin_count,last_lmp_date","description":null,"notificaitonConfigsType":[{"id":"2217c524-4f2b-4f05-9053-7b4ec3fb21dc","type":"QUERY","template":"update\n\timt_member\nset\n\tanc_visit_dates = concat(\n\t\t(\n\t\t\tcase\n\t\t\t\twhen anc_visit_dates is not null then concat(anc_visit_dates, '','')\n\t\t\t\telse null\n\t\t\tend\n\t\t),\n\t\t''#service_date#''\n\t),\n\tlmp = case\n\t\twhen ''#last_lmp_date#'' = ''null'' then imt_member.lmp\n\t\telse cast(\n\t\t\t(\n\t\t\t\tcase\n\t\t\t\t\twhen ''#last_lmp_date#'' = ''null'' then null\n\t\t\t\t\telse ''#last_lmp_date#''\n\t\t\t\tend\n\t\t\t) as date\n\t\t)\n\tend,\n\tedd = case\n\t\twhen ''#edd#'' = ''null'' then imt_member.edd\n\t\telse cast(\n\t\t\t(\n\t\t\t\tcase\n\t\t\t\t\twhen ''#edd#'' = ''null'' then null\n\t\t\t\t\telse ''#edd#''\n\t\t\t\tend\n\t\t\t) as date\n\t\t)\n\tend,\n\tearly_registration = (\n\t\t(\n\t\t\tcase\n\t\t\t\twhen ''#last_lmp_date#'' = ''null'' then imt_member.lmp\n\t\t\t\telse cast(\n\t\t\t\t\t(\n\t\t\t\t\t\tcase\n\t\t\t\t\t\t\twhen ''#last_lmp_date#'' = ''null'' then null\n\t\t\t\t\t\t\telse ''#last_lmp_date#''\n\t\t\t\t\t\tend\n\t\t\t\t\t) as date\n\t\t\t\t)\n\t\t\tend\n\t\t) + 100 * INTERVAL ''1 day''\n\t) >= now(),\n\tweight = (\n\t\tcase\n\t\t\twhen #weight# is not null then #weight# else imt_member.weight end), \n\t\t\tblood_group = (\n\t\t\t\tcase\n\t\t\t\t\twhen ''#blood_group#'' != ''null'' then ''#blood_group#''\n\t\t\t\t\telse imt_member.blood_group\n\t\t\t\tend\n\t\t\t),\n\t\t\t\t\tis_high_risk_case = case\n\t\t\t\t\t\twhen #is_high_risk_case# is not null and #is_high_risk_case# = true then #is_high_risk_case# else imt_member.is_high_risk_case end, \n\t\t\t\t\t\thaemoglobin = case\n\t\t\t\t\t\t\twhen #haemoglobin_count# is not null then #haemoglobin_count# else imt_member.haemoglobin end, \n\t\t\t\t\t\t\tlast_delivery_outcome = case\n\t\t\t\t\t\t\t\twhen ''#last_delivery_outcome#'' != ''null'' then ''#last_delivery_outcome#''\n\t\t\t\t\t\t\t\telse imt_member.last_delivery_outcome\n\t\t\t\t\t\t\tend,\n\t\t\t\t\t\t\tmodified_on = now(),\n\t\t\t\t\t\t\tmodified_by = #created_by# where id = #member_id#;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,is_high_risk_case,edd,service_date,last_delivery_outcome,weight,blood_group,haemoglobin_count,last_lmp_date,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#last_lmp_date#'' != ''null'' && ''#member_status#'' != ''WRONGLY_REGISTERED''","conditionParam":"member_status,last_lmp_date","description":null,"notificaitonConfigsType":[{"id":"c8002440-07ae-4b5b-b9b3-f488eb41264d","type":"QUERY","template":"update rch_pregnancy_registration_det set lmp_date = ''#last_lmp_date#'', edd = (cast(''#last_lmp_date#'' as date) + interval ''1'' day * 281), modified_on = now(), modified_by = #created_by#  where id = #pregnancy_reg_det_id#;\nupdate event_mobile_notification_pending set base_date = ''#last_lmp_date#'', modified_on = now(), modified_by = #created_by#  where member_id = #member_id#  and notification_configuration_type_id in (''5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a'',''faedb8e7-3e46-40a2-a9ac-ea7d5de944fa'') and ref_code = #pregnancy_reg_det_id#;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,last_lmp_date,created_by,pregnancy_reg_det_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#pregnancy_reg_det_id#'' == ''null'' || ''#pregnancy_reg_det_id#'' == ''-1''","conditionParam":"pregnancy_reg_det_id","description":null,"notificaitonConfigsType":[{"id":"fbe31e48-ade3-441f-8e4c-391a00f4cee2","type":"QUERY","template":"update rch_anc_master set pregnancy_reg_det_id = #cur_preg_reg_det_id# where id = #id#","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"cur_preg_reg_det_id,id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#tt1_given_date#'' != ''null'' && ''#tt2_given_date#'' == ''null'' && #tt2_event_configured# == false && #tt2_alert_id# == null","conditionParam":"tt1_given_date,tt2_given_date,tt2_event_configured,tt2_alert_id","description":"This will generate the TT2 alert for the beneficiary","notificaitonConfigsType":[{"id":"45056772-3000-40ea-926c-a63a4f140e38","type":"MOBILE","template":null,"mobileNotificationType":35,"mobileNotificationTypeUUID":"cb251690-e755-4e6f-aacd-32deccb13b79","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"tt1_given_date","refCode":"pregnancy_reg_det_id","memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"e2b029c3-65e6-48f7-a1c7-15e33bd32d97","notificationCode":"0","numberOfDaysAddedForOnDate":28,"numberOfDaysAddedForDueDate":31,"numberOfDaysAddedForExpiryDate":null,"notificationTypeConfigId":"45056772-3000-40ea-926c-a63a4f140e38"}],"configId":19,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#tt2_given_date#'' != ''null'' && #tt2_alert_id# != null","conditionParam":"tt2_given_date,tt2_alert_id","description":null,"notificaitonConfigsType":[{"id":"522984cd-ccc4-4efb-84e8-ded121c6b2bd","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"eventConfigUUID":null,"queryMasterId":null,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"tt2_alert_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#iron_sucrose_due_date#'' != ''null''","conditionParam":"iron_sucrose_due_date","description":null,"notificaitonConfigsType":[{"id":"a2cd5671-beda-4e6d-a355-5f1b107369c7","type":"MOBILE","template":null,"mobileNotificationType":36,"mobileNotificationTypeUUID":"99d837e9-3df4-4dc9-aafc-b84660d8b066","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"iron_sucrose_due_date","refCode":"pregnancy_reg_det_id","memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"0e41aa0f-d0b0-47c4-ab65-e4fdbe1c07a3","notificationCode":"0","numberOfDaysAddedForOnDate":0,"numberOfDaysAddedForDueDate":3,"numberOfDaysAddedForExpiryDate":null,"notificationTypeConfigId":"a2cd5671-beda-4e6d-a355-5f1b107369c7"}],"configId":19,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]}],"status":null,"completionTime":null,"configJson":null,"uuid":"b0c0867b-d2b9-4ba4-8feb-b8d20147addd"}',  current_date , 1, 'b0c0867b-d2b9-4ba4-8feb-b8d20147addd', 'ANC_config');