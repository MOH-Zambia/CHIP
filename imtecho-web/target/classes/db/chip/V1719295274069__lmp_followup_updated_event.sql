DELETE FROM EVENT_CONFIGURATION WHERE uuid = 'fd52fb4e-aa72-41a9-ae33-f507b7022709';

INSERT INTO EVENT_CONFIGURATION(created_by, created_on, modified_by, modified_on, day, description, event_type, event_type_detail_id, form_type_id, hour, minute, name, config_json, state, trigger_when, event_type_detail_code, uuid)
VALUES (
1027,  current_date , 1027,  current_date , null, null, 'FORM_SUBMITTED', null, 1, null, null, 'LMP Followup', '[{"query":"select rch_lmp_follow_up.id, rch_lmp_follow_up.member_id, member_status, year, imt_family.id as family_id, \nto_char(rch_lmp_follow_up.date_of_wedding, ''MM/DD/YYYY'') as date_of_wedding,  \nto_char(rch_lmp_follow_up.service_date,''MM/DD/YYYY'') as service_date, \n(case when imt_family.area_id is null then imt_family.location_id else cast(imt_family.area_id as integer) end) as location_id, \n(select id from location_level_hierarchy_master where location_id = (case when imt_family.area_id is null then imt_family.location_id else cast(imt_family.area_id as integer) end)) as location_hierarchy_id, \nto_char(rch_lmp_follow_up.lmp, ''MM/DD/YYYY'') as lmp_date, \nto_char(rch_lmp_follow_up.lmp, ''MM/DD/YYYY'') as last_lmp_date, \nto_char(now(), ''MM/DD/YYYY'') as cur_date, \nto_char((rch_lmp_follow_up.lmp + interval ''1'' day * (case when normal_cycle_days is null then 28 else normal_cycle_days end)), ''MM/DD/YYYY'') as next_lmp_date, \nto_char((rch_lmp_follow_up.lmp + interval ''1'' day * 281), ''MM/DD/YYYY'') as edd, \nrch_lmp_follow_up.family_planning_method as family_planning_method, \n(case when rch_lmp_follow_up.family_planning_method is null then imt_member.last_method_of_contraception else rch_lmp_follow_up.family_planning_method end) as last_method_of_contraception, \nto_char(rch_lmp_follow_up.fp_insert_operate_date, ''MM/DD/YYYY'') as fp_insert_operate_date, \n(case when rch_lmp_follow_up.fp_insert_operate_date is null then imt_member.fp_insert_operate_date + interval ''90'' day > (rch_lmp_follow_up.lmp + interval ''1'' day * (case when normal_cycle_days is null then 28 else normal_cycle_days end)) else rch_lmp_follow_up.fp_insert_operate_date + interval ''90'' day > (rch_lmp_follow_up.lmp + interval ''1'' day * (case when normal_cycle_days is null then 28 else normal_cycle_days end)) end) as to_generate_lmp_visit, \nrch_lmp_follow_up.is_pregnant, \ntecho_notification_master.id as notification_id, \nrch_lmp_follow_up.created_by as created_by, \nto_char(death_date, ''MM/DD/YYYY'') as death_date, \ndeath_reason, place_of_death, cast(null as text) as other_death_reason, death_infra_id,\ntecho_notification_master.notification_code, \nto_char(case when imt_member.lmp is null then now() else imt_member.lmp end, ''MM/DD/YYYY'') as next_lmp_schedule_date, \nrch_lmp_follow_up.current_gravida, rch_lmp_follow_up.current_para\nfrom rch_lmp_follow_up inner join imt_member on rch_lmp_follow_up.member_id = imt_member.id \ninner join imt_family on imt_member.family_id = imt_family.family_id \nleft join techo_notification_master on techo_notification_master.member_id = rch_lmp_follow_up.member_id \nand techo_notification_master.notification_type_id = 1 \nand techo_notification_master.state in (''PENDING'',''RESCHEDULE'') \nwhere rch_lmp_follow_up.id = #resourceId# limit 1;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"''#member_status#'' == ''AVAILABLE'' && ''#lmp_date#'' == ''null'' && (''#is_pregnant#'' == ''null'' || #is_pregnant# == false) && ''#notification_code#'' == ''0''","conditionParam":"lmp_date,is_pregnant,member_status,notification_code","description":null,"notificaitonConfigsType":[{"id":"dc474c48-fe8d-466f-bfc9-05861100a7cb","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":52,"queryCode":"mob_notification_reschedule","queryMasterParamJson":[{"parameterName":"expiary_days_add","mappingValue":null,"isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"due_days_add","mappingValue":null,"isFixed":false},{"parameterName":"schedule_days_add","mappingValue":"5","isFixed":true},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"54021c0f-093c-4eae-899a-adb2f9eff1c9","type":"QUERY","template":"update techo_notification_master set notification_code = case when notification_code = ''0'' then cast(cast(notification_code as integer) + 1 as character varying) else notification_code end where id = #notification_id#","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"notification_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#member_status#'' == ''DEATH''","conditionParam":"member_status","description":null,"notificaitonConfigsType":[{"id":"91f1cd4e-b006-4ac3-bfe0-c30595675413","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"7ebffd7f-3205-423e-b3d0-51c87fb5f3d6","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":56,"queryCode":"mark_member_as_death","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"location_hierarchy_id","mappingValue":"location_hierarchy_id","isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"service_type","mappingValue":"FHW_LMP","isFixed":true},{"parameterName":"reference_id","mappingValue":"id","isFixed":false},{"parameterName":"death_reason","mappingValue":"death_reason","isFixed":false},{"parameterName":"other_death_reason","mappingValue":"other_death_reason","isFixed":false},{"parameterName":"place_of_death","mappingValue":"place_of_death","isFixed":false},{"parameterName":"location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"death_date","mappingValue":"death_date","isFixed":false},{"parameterName":"health_infra_id","mappingValue":"death_infra_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"#year# != null || ''#lmp_date#'' != ''null'' || ''#family_planning_method#'' != ''null'' || ''#fp_insert_operate_date#'' != ''null'' || ''#date_of_wedding#'' != ''null'' || #current_gravida# != null || #current_para# != null","conditionParam":"lmp_date,date_of_wedding,year,fp_insert_operate_date,family_planning_method,current_para,current_gravida","description":null,"notificaitonConfigsType":[{"id":"70fcf116-10f7-44be-b309-53bd71ef19a7","type":"QUERY","template":"update imt_member set year_of_wedding = (case when #year#  is not null then #year# else year_of_wedding  end), \ndate_of_wedding = (case when ''#date_of_wedding#'' != ''null'' then to_date((case when ''#date_of_wedding#'' = ''null'' then ''1970-01-01'' else ''#date_of_wedding#'' end), ''MM/DD/YYYY'') else date_of_wedding end),\nlmp = (case when ''#lmp_date#'' != ''null'' then to_date((case when ''#lmp_date#'' = ''null'' then ''1970-01-01'' else ''#lmp_date#'' end), ''MM/DD/YYYY'') else lmp end), \nlast_method_of_contraception = (case when ''#family_planning_method#'' != ''null'' then ''#family_planning_method#'' else last_method_of_contraception end),\nfp_insert_operate_date = (\n\tcase when ''#fp_insert_operate_date#'' != ''null'' \n\t\tthen to_date(case when ''#fp_insert_operate_date#'' = ''null'' then ''1970-01-01'' else ''#fp_insert_operate_date#'' end, ''MM/DD/YYYY'') \n\t\telse fp_insert_operate_date end),\ncurrent_gravida = case when #current_gravida# is not null then #current_gravida# else current_gravida end,\ncurrent_para = case when #current_para# is not null then #current_para# else current_para end,\nmodified_by = #created_by#, modified_on = now() \nwhere id =  #member_id#;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"date_of_wedding,lmp_date,member_id,year,fp_insert_operate_date,family_planning_method,current_para,created_by,current_gravida","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#lmp_date#'' !== ''null''","conditionParam":"lmp_date","description":null,"notificaitonConfigsType":[{"id":"b059db39-4a17-41a4-a2dd-fc57582c717a","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#is_pregnant#'' !== ''null'' && #is_pregnant# == true","conditionParam":"is_pregnant","description":null,"notificaitonConfigsType":[{"id":"81880422-23d5-43a6-8bf9-42d968b64f43","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a","type":"MOBILE","template":null,"mobileNotificationType":2,"mobileNotificationTypeUUID":"d6eae54f-0650-4985-9628-c6a37a92c4d4","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"last_lmp_date","refCode":"","memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"5ee09d52-f3ec-4c75-8a02-d18a7e6ce066","notificationCode":"1","numberOfDaysAddedForOnDate":0,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":91,"notificationTypeConfigId":"5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a"},{"id":"a90441c0-20cb-423e-9626-6e991a48375d","notificationCode":"2","numberOfDaysAddedForOnDate":92,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":189,"notificationTypeConfigId":"5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a"},{"id":"06e835bb-f352-4f53-a5bf-76cb93685529","notificationCode":"3","numberOfDaysAddedForOnDate":190,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":245,"notificationTypeConfigId":"5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a"},{"id":"28a9d911-4a3d-45d8-ae9d-02d241348302","notificationCode":"4","numberOfDaysAddedForOnDate":246,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":null,"notificationTypeConfigId":"5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a"}],"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"fb77b27a-fd04-434e-b856-2c563f63af27","type":"MOBILE","template":null,"mobileNotificationType":44,"mobileNotificationTypeUUID":"36c98c12-2dd1-4593-956b-4d8f9e02419d","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"last_lmp_date","refCode":null,"memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"a268b579-fa16-4c61-a401-c2c4deb516f0","notificationCode":"1","numberOfDaysAddedForOnDate":0,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":160,"notificationTypeConfigId":"fb77b27a-fd04-434e-b856-2c563f63af27"},{"id":"c387698c-e0a3-4216-ba24-8909505dca9a","notificationCode":"2","numberOfDaysAddedForOnDate":161,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":216,"notificationTypeConfigId":"fb77b27a-fd04-434e-b856-2c563f63af27"},{"id":"65d265be-9ae4-4c50-a6f8-e8f14daf8dc0","notificationCode":"3","numberOfDaysAddedForOnDate":217,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":244,"notificationTypeConfigId":"fb77b27a-fd04-434e-b856-2c563f63af27"},{"id":"53bcfb3d-5b31-401b-a7b8-e9e91d6d6441","notificationCode":"4","numberOfDaysAddedForOnDate":245,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":null,"notificationTypeConfigId":"fb77b27a-fd04-434e-b856-2c563f63af27"}],"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"faedb8e7-3e46-40a2-a9ac-ea7d5de944fa","type":"MOBILE","template":null,"mobileNotificationType":5,"mobileNotificationTypeUUID":"7d3d809f-e90f-40a2-95a8-f1e5fe3aeb0d","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"last_lmp_date","refCode":null,"memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"1337a6d4-d98d-4000-83ca-b81a5151c869","notificationCode":"0","numberOfDaysAddedForOnDate":267,"numberOfDaysAddedForDueDate":7,"numberOfDaysAddedForExpiryDate":null,"notificationTypeConfigId":"faedb8e7-3e46-40a2-a9ac-ea7d5de944fa"}],"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"e57ce81b-d5a8-4d40-a8c1-fe265a8536e7","type":"QUERY","template":"-- Removed this query as discussed with @hshah & @kunjanp in git issue #2983\n--update imt_member set immunisation_given = t.immunisation\n--from (\n--\tselect imt_member.id as member_id, \n--\tcase when rch_immunisation_master.immunisation_given is null then null \n--\t\telse concat(rch_immunisation_master.immunisation_given, ''#'',\n--\t\tto_char(max(rch_immunisation_master.given_on),''DD/MM/YYYY'')) end as immunisation\n--\tfrom imt_member \n--\tleft join rch_immunisation_master on rch_immunisation_master.member_id = imt_member.id\n--\tinner join rch_pregnancy_registration_det on rch_pregnancy_registration_det.id = imt_member.cur_preg_reg_det_id\n--\twhere imt_member.id = #member_id#\n--\tand rch_immunisation_master.pregnancy_reg_det_id = imt_member.cur_preg_reg_det_id\n--\tand rch_pregnancy_registration_det.state = ''DELIVERY_DONE''\n--\tgroup by imt_member.id, rch_immunisation_master.immunisation_given\n--) as t where t.member_id = imt_member.id;\n\n\nwith rows as (\nINSERT INTO rch_pregnancy_registration_det(\n            member_id, family_id, lmp_date, edd, reg_date, state,location_id,current_location_id, created_on, \n            created_by, modified_on, modified_by)\n    VALUES (#member_id#, #family_id#, ''#last_lmp_date#'', ''#edd#'', ''#service_date#'', ''PENDING'', #location_id#, #location_id# ,now(), \n            #created_by#, now(), #created_by#) RETURNING id\n)\n\n\tupdate imt_member set is_pregnant = true, edd =  ''#edd#'', \n\tearly_registration = (to_date(''#last_lmp_date#'', ''MM/DD/YYYY'') + INTERVAL ''84 days'') >= to_date(''#service_date#'', ''MM/DD/YYYY'') , \n\tcur_preg_reg_det_id = (select id from rows),\n\tcur_preg_reg_date=''#service_date#'',\n\tanc_visit_dates = null,\n\timmunisation_given = null,\n\tmodified_by = ''#created_by#'', modified_on = now()\n\twhere id= #member_id#","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,family_id,edd,service_date,last_lmp_date,created_by,location_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"112fbaf9-9f82-4b38-9a12-d3a06a31dd33","type":"QUERY","template":"update event_mobile_notification_pending set ref_code = (select cur_preg_reg_det_id from imt_member where id = ''#member_id#'') where member_id = ''#member_id#'' and state = ''PENDING'' and ref_code=-1;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"8c06b081-964e-4bba-ba2d-3e349a644652","type":"QUERY","template":"update techo_notification_master set state = ''MARK_AS_PREGNANT'' where member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE'') and notification_type_id = (select id from notification_type_master where code = ''LMPFU'')","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"a7b9413a-f112-4180-bb13-ea60f1054b5e","type":"QUERY","template":"update techo_notification_master set ref_code = (select cur_preg_reg_det_id from imt_member where id = #member_id#)\nwhere member_id = #member_id# and state in (''PENDING'') and \nnotification_type_id in (select id from notification_type_master where code in (''FHW_ANC'',''FHW_WPD''));","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#lmp_date#'' !== ''null'' && #is_pregnant# == false && (''#last_method_of_contraception#'' == ''null'' || (''#last_method_of_contraception#'' != ''MLSTR'' && ''#last_method_of_contraception#'' != ''FMLSTR''))","conditionParam":"lmp_date,is_pregnant,last_method_of_contraception","description":null,"notificaitonConfigsType":[{"id":"578fc23c-b2fe-4172-b127-8bb1d9192cbb","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":"generate_lmp_followup","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#last_method_of_contraception#'' != ''null'' && (''#last_method_of_contraception#'' == ''MLSTR'' || ''#last_method_of_contraception#'' == ''FMLSTR'') && ''#to_generate_lmp_visit#''","conditionParam":"to_generate_lmp_visit,last_method_of_contraception","description":null,"notificaitonConfigsType":[{"id":"aa4f85aa-3043-48c9-8d04-e4093abff918","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":"generate_lmp_followup","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#member_status#'' == ''AVAILABLE'' && ''#lmp_date#'' == ''null'' && (''#is_pregnant#'' == ''null'' || #is_pregnant# == false) && ''#notification_code#'' == ''1''","conditionParam":"lmp_date,is_pregnant,member_status,notification_code","description":null,"notificaitonConfigsType":[{"id":"68539887-b180-4461-b418-ddac0470d653","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"0214a9cd-f111-452a-bc81-8408cc5f03b4","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":"generate_lmp_followup","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_schedule_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]}]', 'ACTIVE', null, null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709');

DELETE FROM EVENT_CONFIGURATION_TYPE WHERE event_config_uuid ='fd52fb4e-aa72-41a9-ae33-f507b7022709';

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'dc474c48-fe8d-466f-bfc9-05861100a7cb', null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, null, null, null, 'IMMEDIATELY', 'QUERY', null, null, null, 52, '[{"parameterName":"expiary_days_add","mappingValue":null,"isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"due_days_add","mappingValue":null,"isFixed":false},{"parameterName":"schedule_days_add","mappingValue":"5","isFixed":true},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}]', 'mob_notification_reschedule', null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'54021c0f-093c-4eae-899a-adb2f9eff1c9', null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, null, 'update techo_notification_master set notification_code = case when notification_code = ''0'' then cast(cast(notification_code as integer) + 1 as character varying) else notification_code end where id = #notification_id#', 'notification_id', 'IMMEDIATELY', 'QUERY', null, null, null, null, null, null, null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'91f1cd4e-b006-4ac3-bfe0-c30595675413', null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, null, null, null, 'IMMEDIATELY', 'QUERY', null, null, null, 53, '[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}]', 'mob_notification_mark_as_complete', null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'7ebffd7f-3205-423e-b3d0-51c87fb5f3d6', null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, null, null, null, 'IMMEDIATELY', 'QUERY', null, null, null, 56, '[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"location_hierarchy_id","mappingValue":"location_hierarchy_id","isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"service_type","mappingValue":"FHW_LMP","isFixed":true},{"parameterName":"reference_id","mappingValue":"id","isFixed":false},{"parameterName":"death_reason","mappingValue":"death_reason","isFixed":false},{"parameterName":"other_death_reason","mappingValue":"other_death_reason","isFixed":false},{"parameterName":"place_of_death","mappingValue":"place_of_death","isFixed":false},{"parameterName":"location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"death_date","mappingValue":"death_date","isFixed":false},{"parameterName":"health_infra_id","mappingValue":"death_infra_id","isFixed":false}]', 'mark_member_as_death', null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'70fcf116-10f7-44be-b309-53bd71ef19a7', null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, null, 'update imt_member set year_of_wedding = (case when #year#  is not null then #year# else year_of_wedding  end),
date_of_wedding = (case when ''#date_of_wedding#'' != ''null'' then to_date((case when ''#date_of_wedding#'' = ''null'' then ''1970-01-01'' else ''#date_of_wedding#'' end), ''MM/DD/YYYY'') else date_of_wedding end),
lmp = (case when ''#lmp_date#'' != ''null'' then to_date((case when ''#lmp_date#'' = ''null'' then ''1970-01-01'' else ''#lmp_date#'' end), ''MM/DD/YYYY'') else lmp end),
last_method_of_contraception = (case when ''#family_planning_method#'' != ''null'' then ''#family_planning_method#'' else last_method_of_contraception end),
fp_insert_operate_date = (
	case when ''#fp_insert_operate_date#'' != ''null''
		then to_date(case when ''#fp_insert_operate_date#'' = ''null'' then ''1970-01-01'' else ''#fp_insert_operate_date#'' end, ''MM/DD/YYYY'')
		else fp_insert_operate_date end),
current_gravida = case when #current_gravida# is not null then #current_gravida# else current_gravida end,
current_para = case when #current_para# is not null then #current_para# else current_para end,
modified_by = #created_by#, modified_on = now()
where id =  #member_id#;', 'date_of_wedding,lmp_date,member_id,year,fp_insert_operate_date,family_planning_method,current_para,created_by,current_gravida', 'IMMEDIATELY', 'QUERY', null, null, null, null, null, null, null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'b059db39-4a17-41a4-a2dd-fc57582c717a', null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, null, null, null, 'IMMEDIATELY', 'QUERY', null, null, null, 53, '[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}]', 'mob_notification_mark_as_complete', null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'81880422-23d5-43a6-8bf9-42d968b64f43', null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, null, null, null, 'IMMEDIATELY', 'QUERY', null, null, null, 53, '[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}]', 'mob_notification_mark_as_complete', null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a', 'last_lmp_date', 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, 2, null, null, null, 'MOBILE', null, 'family_id', 'member_id', null, null, null, null, null);

DELETE FROM EVENT_MOBILE_CONFIGURATION WHERE notification_type_config_id ='5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a';

INSERT INTO EVENT_MOBILE_CONFIGURATION(id, notification_code, notification_type_config_id, number_of_days_added_for_due_date, number_of_days_added_for_expiry_date, number_of_days_added_for_on_date)
VALUES (
'5ee09d52-f3ec-4c75-8a02-d18a7e6ce066', '1', '5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a', 28, 91, 0);

INSERT INTO EVENT_MOBILE_CONFIGURATION(id, notification_code, notification_type_config_id, number_of_days_added_for_due_date, number_of_days_added_for_expiry_date, number_of_days_added_for_on_date)
VALUES (
'a90441c0-20cb-423e-9626-6e991a48375d', '2', '5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a', 28, 189, 92);

INSERT INTO EVENT_MOBILE_CONFIGURATION(id, notification_code, notification_type_config_id, number_of_days_added_for_due_date, number_of_days_added_for_expiry_date, number_of_days_added_for_on_date)
VALUES (
'06e835bb-f352-4f53-a5bf-76cb93685529', '3', '5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a', 28, 245, 190);

INSERT INTO EVENT_MOBILE_CONFIGURATION(id, notification_code, notification_type_config_id, number_of_days_added_for_due_date, number_of_days_added_for_expiry_date, number_of_days_added_for_on_date)
VALUES (
'28a9d911-4a3d-45d8-ae9d-02d241348302', '4', '5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a', 28, null, 246);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'fb77b27a-fd04-434e-b856-2c563f63af27', 'last_lmp_date', 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, 44, null, null, null, 'MOBILE', null, 'family_id', 'member_id', null, null, null, null, null);

DELETE FROM EVENT_MOBILE_CONFIGURATION WHERE notification_type_config_id ='fb77b27a-fd04-434e-b856-2c563f63af27';

INSERT INTO EVENT_MOBILE_CONFIGURATION(id, notification_code, notification_type_config_id, number_of_days_added_for_due_date, number_of_days_added_for_expiry_date, number_of_days_added_for_on_date)
VALUES (
'a268b579-fa16-4c61-a401-c2c4deb516f0', '1', 'fb77b27a-fd04-434e-b856-2c563f63af27', 28, 160, 0);

INSERT INTO EVENT_MOBILE_CONFIGURATION(id, notification_code, notification_type_config_id, number_of_days_added_for_due_date, number_of_days_added_for_expiry_date, number_of_days_added_for_on_date)
VALUES (
'c387698c-e0a3-4216-ba24-8909505dca9a', '2', 'fb77b27a-fd04-434e-b856-2c563f63af27', 28, 216, 161);

INSERT INTO EVENT_MOBILE_CONFIGURATION(id, notification_code, notification_type_config_id, number_of_days_added_for_due_date, number_of_days_added_for_expiry_date, number_of_days_added_for_on_date)
VALUES (
'65d265be-9ae4-4c50-a6f8-e8f14daf8dc0', '3', 'fb77b27a-fd04-434e-b856-2c563f63af27', 28, 244, 217);

INSERT INTO EVENT_MOBILE_CONFIGURATION(id, notification_code, notification_type_config_id, number_of_days_added_for_due_date, number_of_days_added_for_expiry_date, number_of_days_added_for_on_date)
VALUES (
'53bcfb3d-5b31-401b-a7b8-e9e91d6d6441', '4', 'fb77b27a-fd04-434e-b856-2c563f63af27', 28, null, 245);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'faedb8e7-3e46-40a2-a9ac-ea7d5de944fa', 'last_lmp_date', 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, 5, null, null, null, 'MOBILE', null, 'family_id', 'member_id', null, null, null, null, null);

DELETE FROM EVENT_MOBILE_CONFIGURATION WHERE notification_type_config_id ='faedb8e7-3e46-40a2-a9ac-ea7d5de944fa';

INSERT INTO EVENT_MOBILE_CONFIGURATION(id, notification_code, notification_type_config_id, number_of_days_added_for_due_date, number_of_days_added_for_expiry_date, number_of_days_added_for_on_date)
VALUES (
'1337a6d4-d98d-4000-83ca-b81a5151c869', '0', 'faedb8e7-3e46-40a2-a9ac-ea7d5de944fa', 7, null, 267);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'e57ce81b-d5a8-4d40-a8c1-fe265a8536e7', null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, null, '-- Removed this query as discussed with @hshah & @kunjanp in git issue #2983
--update imt_member set immunisation_given = t.immunisation
--from (
--	select imt_member.id as member_id,
--	case when rch_immunisation_master.immunisation_given is null then null
--		else concat(rch_immunisation_master.immunisation_given, ''#'',
--		to_char(max(rch_immunisation_master.given_on),''DD/MM/YYYY'')) end as immunisation
--	from imt_member
--	left join rch_immunisation_master on rch_immunisation_master.member_id = imt_member.id
--	inner join rch_pregnancy_registration_det on rch_pregnancy_registration_det.id = imt_member.cur_preg_reg_det_id
--	where imt_member.id = #member_id#
--	and rch_immunisation_master.pregnancy_reg_det_id = imt_member.cur_preg_reg_det_id
--	and rch_pregnancy_registration_det.state = ''DELIVERY_DONE''
--	group by imt_member.id, rch_immunisation_master.immunisation_given
--) as t where t.member_id = imt_member.id;


with rows as (
INSERT INTO rch_pregnancy_registration_det(
            member_id, family_id, lmp_date, edd, reg_date, state,location_id,current_location_id, created_on,
            created_by, modified_on, modified_by)
    VALUES (#member_id#, #family_id#, ''#last_lmp_date#'', ''#edd#'', ''#service_date#'', ''PENDING'', #location_id#, #location_id# ,now(),
            #created_by#, now(), #created_by#) RETURNING id
)

	update imt_member set is_pregnant = true, edd =  ''#edd#'',
	early_registration = (to_date(''#last_lmp_date#'', ''MM/DD/YYYY'') + INTERVAL ''84 days'') >= to_date(''#service_date#'', ''MM/DD/YYYY'') ,
	cur_preg_reg_det_id = (select id from rows),
	cur_preg_reg_date=''#service_date#'',
	anc_visit_dates = null,
	immunisation_given = null,
	modified_by = ''#created_by#'', modified_on = now()
	where id= #member_id#', 'member_id,family_id,edd,service_date,last_lmp_date,created_by,location_id', 'IMMEDIATELY', 'QUERY', null, null, null, null, null, null, null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'112fbaf9-9f82-4b38-9a12-d3a06a31dd33', null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, null, 'update event_mobile_notification_pending set ref_code = (select cur_preg_reg_det_id from imt_member where id = ''#member_id#'') where member_id = ''#member_id#'' and state = ''PENDING'' and ref_code=-1;', 'member_id', 'IMMEDIATELY', 'QUERY', null, null, null, null, null, null, null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'8c06b081-964e-4bba-ba2d-3e349a644652', null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, null, 'update techo_notification_master set state = ''MARK_AS_PREGNANT'' where member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE'') and notification_type_id = (select id from notification_type_master where code = ''LMPFU'')', 'member_id', 'IMMEDIATELY', 'QUERY', null, null, null, null, null, null, null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'a7b9413a-f112-4180-bb13-ea60f1054b5e', null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, null, 'update techo_notification_master set ref_code = (select cur_preg_reg_det_id from imt_member where id = #member_id#)
where member_id = #member_id# and state in (''PENDING'') and
notification_type_id in (select id from notification_type_master where code in (''FHW_ANC'',''FHW_WPD''));', 'member_id', 'IMMEDIATELY', 'QUERY', null, null, null, null, null, null, null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'578fc23c-b2fe-4172-b127-8bb1d9192cbb', null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, null, null, null, 'IMMEDIATELY', 'QUERY', null, null, null, null, '[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}]', 'generate_lmp_followup', null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'aa4f85aa-3043-48c9-8d04-e4093abff918', null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, null, null, null, 'IMMEDIATELY', 'QUERY', null, null, null, null, '[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}]', 'generate_lmp_followup', null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'68539887-b180-4461-b418-ddac0470d653', null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, null, null, null, 'IMMEDIATELY', 'QUERY', null, null, null, null, '[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}]', 'mob_notification_mark_as_complete', null, null);

INSERT INTO EVENT_CONFIGURATION_TYPE(id, base_date_field_name, event_config_uuid, day, email_subject, email_subject_parameter, hour, minute, mobile_notification_type, template, template_parameter, triger_when, type, user_field_name, family_field_name, member_field_name, query_master_id, query_master_param_json, query_code, sms_config_json, push_notification_config_json)
VALUES (
'0214a9cd-f111-452a-bc81-8408cc5f03b4', null, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', null, null, null, null, null, null, null, null, 'IMMEDIATELY', 'QUERY', null, null, null, null, '[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_schedule_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}]', 'generate_lmp_followup', null, null);

INSERT INTO SYNC_SYSTEM_CONFIGURATION_MASTER(feature_type, config_json, created_on, created_by, feature_uuid, feature_name)
VALUES (
'EVENT_BUILDER', '{"id":24,"name":"LMP Followup","description":null,"eventType":"FORM_SUBMITTED","eventTypeDetailId":null,"formTypeId":1,"eventTypeDetailCode":null,"trigerWhen":null,"day":null,"hour":null,"minute":null,"state":"ACTIVE","createdBy":1027,"createdOn":1719295341227,"notificationConfigDetails":[{"query":"select rch_lmp_follow_up.id, rch_lmp_follow_up.member_id, member_status, year, imt_family.id as family_id, \nto_char(rch_lmp_follow_up.date_of_wedding, ''MM/DD/YYYY'') as date_of_wedding,  \nto_char(rch_lmp_follow_up.service_date,''MM/DD/YYYY'') as service_date, \n(case when imt_family.area_id is null then imt_family.location_id else cast(imt_family.area_id as integer) end) as location_id, \n(select id from location_level_hierarchy_master where location_id = (case when imt_family.area_id is null then imt_family.location_id else cast(imt_family.area_id as integer) end)) as location_hierarchy_id, \nto_char(rch_lmp_follow_up.lmp, ''MM/DD/YYYY'') as lmp_date, \nto_char(rch_lmp_follow_up.lmp, ''MM/DD/YYYY'') as last_lmp_date, \nto_char(now(), ''MM/DD/YYYY'') as cur_date, \nto_char((rch_lmp_follow_up.lmp + interval ''1'' day * (case when normal_cycle_days is null then 28 else normal_cycle_days end)), ''MM/DD/YYYY'') as next_lmp_date, \nto_char((rch_lmp_follow_up.lmp + interval ''1'' day * 281), ''MM/DD/YYYY'') as edd, \nrch_lmp_follow_up.family_planning_method as family_planning_method, \n(case when rch_lmp_follow_up.family_planning_method is null then imt_member.last_method_of_contraception else rch_lmp_follow_up.family_planning_method end) as last_method_of_contraception, \nto_char(rch_lmp_follow_up.fp_insert_operate_date, ''MM/DD/YYYY'') as fp_insert_operate_date, \n(case when rch_lmp_follow_up.fp_insert_operate_date is null then imt_member.fp_insert_operate_date + interval ''90'' day > (rch_lmp_follow_up.lmp + interval ''1'' day * (case when normal_cycle_days is null then 28 else normal_cycle_days end)) else rch_lmp_follow_up.fp_insert_operate_date + interval ''90'' day > (rch_lmp_follow_up.lmp + interval ''1'' day * (case when normal_cycle_days is null then 28 else normal_cycle_days end)) end) as to_generate_lmp_visit, \nrch_lmp_follow_up.is_pregnant, \ntecho_notification_master.id as notification_id, \nrch_lmp_follow_up.created_by as created_by, \nto_char(death_date, ''MM/DD/YYYY'') as death_date, \ndeath_reason, place_of_death, cast(null as text) as other_death_reason, death_infra_id,\ntecho_notification_master.notification_code, \nto_char(case when imt_member.lmp is null then now() else imt_member.lmp end, ''MM/DD/YYYY'') as next_lmp_schedule_date, \nrch_lmp_follow_up.current_gravida, rch_lmp_follow_up.current_para\nfrom rch_lmp_follow_up inner join imt_member on rch_lmp_follow_up.member_id = imt_member.id \ninner join imt_family on imt_member.family_id = imt_family.family_id \nleft join techo_notification_master on techo_notification_master.member_id = rch_lmp_follow_up.member_id \nand techo_notification_master.notification_type_id = 1 \nand techo_notification_master.state in (''PENDING'',''RESCHEDULE'') \nwhere rch_lmp_follow_up.id = #resourceId# limit 1;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"''#member_status#'' == ''AVAILABLE'' && ''#lmp_date#'' == ''null'' && (''#is_pregnant#'' == ''null'' || #is_pregnant# == false) && ''#notification_code#'' == ''0''","conditionParam":"lmp_date,is_pregnant,member_status,notification_code","description":null,"notificaitonConfigsType":[{"id":"dc474c48-fe8d-466f-bfc9-05861100a7cb","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":52,"queryCode":"mob_notification_reschedule","queryMasterParamJson":[{"parameterName":"expiary_days_add","mappingValue":null,"isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"due_days_add","mappingValue":null,"isFixed":false},{"parameterName":"schedule_days_add","mappingValue":"5","isFixed":true},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"54021c0f-093c-4eae-899a-adb2f9eff1c9","type":"QUERY","template":"update techo_notification_master set notification_code = case when notification_code = ''0'' then cast(cast(notification_code as integer) + 1 as character varying) else notification_code end where id = #notification_id#","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"notification_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#member_status#'' == ''DEATH''","conditionParam":"member_status","description":null,"notificaitonConfigsType":[{"id":"91f1cd4e-b006-4ac3-bfe0-c30595675413","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"7ebffd7f-3205-423e-b3d0-51c87fb5f3d6","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":56,"queryCode":"mark_member_as_death","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"location_hierarchy_id","mappingValue":"location_hierarchy_id","isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"service_type","mappingValue":"FHW_LMP","isFixed":true},{"parameterName":"reference_id","mappingValue":"id","isFixed":false},{"parameterName":"death_reason","mappingValue":"death_reason","isFixed":false},{"parameterName":"other_death_reason","mappingValue":"other_death_reason","isFixed":false},{"parameterName":"place_of_death","mappingValue":"place_of_death","isFixed":false},{"parameterName":"location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"death_date","mappingValue":"death_date","isFixed":false},{"parameterName":"health_infra_id","mappingValue":"death_infra_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"#year# != null || ''#lmp_date#'' != ''null'' || ''#family_planning_method#'' != ''null'' || ''#fp_insert_operate_date#'' != ''null'' || ''#date_of_wedding#'' != ''null'' || #current_gravida# != null || #current_para# != null","conditionParam":"lmp_date,date_of_wedding,year,fp_insert_operate_date,family_planning_method,current_para,current_gravida","description":null,"notificaitonConfigsType":[{"id":"70fcf116-10f7-44be-b309-53bd71ef19a7","type":"QUERY","template":"update imt_member set year_of_wedding = (case when #year#  is not null then #year# else year_of_wedding  end), \ndate_of_wedding = (case when ''#date_of_wedding#'' != ''null'' then to_date((case when ''#date_of_wedding#'' = ''null'' then ''1970-01-01'' else ''#date_of_wedding#'' end), ''MM/DD/YYYY'') else date_of_wedding end),\nlmp = (case when ''#lmp_date#'' != ''null'' then to_date((case when ''#lmp_date#'' = ''null'' then ''1970-01-01'' else ''#lmp_date#'' end), ''MM/DD/YYYY'') else lmp end), \nlast_method_of_contraception = (case when ''#family_planning_method#'' != ''null'' then ''#family_planning_method#'' else last_method_of_contraception end),\nfp_insert_operate_date = (\n\tcase when ''#fp_insert_operate_date#'' != ''null'' \n\t\tthen to_date(case when ''#fp_insert_operate_date#'' = ''null'' then ''1970-01-01'' else ''#fp_insert_operate_date#'' end, ''MM/DD/YYYY'') \n\t\telse fp_insert_operate_date end),\ncurrent_gravida = case when #current_gravida# is not null then #current_gravida# else current_gravida end,\ncurrent_para = case when #current_para# is not null then #current_para# else current_para end,\nmodified_by = #created_by#, modified_on = now() \nwhere id =  #member_id#;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"date_of_wedding,lmp_date,member_id,year,fp_insert_operate_date,family_planning_method,current_para,created_by,current_gravida","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#lmp_date#'' !== ''null''","conditionParam":"lmp_date","description":null,"notificaitonConfigsType":[{"id":"b059db39-4a17-41a4-a2dd-fc57582c717a","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#is_pregnant#'' !== ''null'' && #is_pregnant# == true","conditionParam":"is_pregnant","description":null,"notificaitonConfigsType":[{"id":"81880422-23d5-43a6-8bf9-42d968b64f43","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a","type":"MOBILE","template":null,"mobileNotificationType":2,"mobileNotificationTypeUUID":"d6eae54f-0650-4985-9628-c6a37a92c4d4","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"last_lmp_date","refCode":"","memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"5ee09d52-f3ec-4c75-8a02-d18a7e6ce066","notificationCode":"1","numberOfDaysAddedForOnDate":0,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":91,"notificationTypeConfigId":"5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a"},{"id":"a90441c0-20cb-423e-9626-6e991a48375d","notificationCode":"2","numberOfDaysAddedForOnDate":92,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":189,"notificationTypeConfigId":"5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a"},{"id":"06e835bb-f352-4f53-a5bf-76cb93685529","notificationCode":"3","numberOfDaysAddedForOnDate":190,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":245,"notificationTypeConfigId":"5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a"},{"id":"28a9d911-4a3d-45d8-ae9d-02d241348302","notificationCode":"4","numberOfDaysAddedForOnDate":246,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":null,"notificationTypeConfigId":"5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a"}],"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"fb77b27a-fd04-434e-b856-2c563f63af27","type":"MOBILE","template":null,"mobileNotificationType":44,"mobileNotificationTypeUUID":"36c98c12-2dd1-4593-956b-4d8f9e02419d","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"last_lmp_date","refCode":null,"memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"a268b579-fa16-4c61-a401-c2c4deb516f0","notificationCode":"1","numberOfDaysAddedForOnDate":0,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":160,"notificationTypeConfigId":"fb77b27a-fd04-434e-b856-2c563f63af27"},{"id":"c387698c-e0a3-4216-ba24-8909505dca9a","notificationCode":"2","numberOfDaysAddedForOnDate":161,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":216,"notificationTypeConfigId":"fb77b27a-fd04-434e-b856-2c563f63af27"},{"id":"65d265be-9ae4-4c50-a6f8-e8f14daf8dc0","notificationCode":"3","numberOfDaysAddedForOnDate":217,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":244,"notificationTypeConfigId":"fb77b27a-fd04-434e-b856-2c563f63af27"},{"id":"53bcfb3d-5b31-401b-a7b8-e9e91d6d6441","notificationCode":"4","numberOfDaysAddedForOnDate":245,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":null,"notificationTypeConfigId":"fb77b27a-fd04-434e-b856-2c563f63af27"}],"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"faedb8e7-3e46-40a2-a9ac-ea7d5de944fa","type":"MOBILE","template":null,"mobileNotificationType":5,"mobileNotificationTypeUUID":"7d3d809f-e90f-40a2-95a8-f1e5fe3aeb0d","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"last_lmp_date","refCode":null,"memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"1337a6d4-d98d-4000-83ca-b81a5151c869","notificationCode":"0","numberOfDaysAddedForOnDate":267,"numberOfDaysAddedForDueDate":7,"numberOfDaysAddedForExpiryDate":null,"notificationTypeConfigId":"faedb8e7-3e46-40a2-a9ac-ea7d5de944fa"}],"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"e57ce81b-d5a8-4d40-a8c1-fe265a8536e7","type":"QUERY","template":"-- Removed this query as discussed with @hshah & @kunjanp in git issue #2983\n--update imt_member set immunisation_given = t.immunisation\n--from (\n--\tselect imt_member.id as member_id, \n--\tcase when rch_immunisation_master.immunisation_given is null then null \n--\t\telse concat(rch_immunisation_master.immunisation_given, ''#'',\n--\t\tto_char(max(rch_immunisation_master.given_on),''DD/MM/YYYY'')) end as immunisation\n--\tfrom imt_member \n--\tleft join rch_immunisation_master on rch_immunisation_master.member_id = imt_member.id\n--\tinner join rch_pregnancy_registration_det on rch_pregnancy_registration_det.id = imt_member.cur_preg_reg_det_id\n--\twhere imt_member.id = #member_id#\n--\tand rch_immunisation_master.pregnancy_reg_det_id = imt_member.cur_preg_reg_det_id\n--\tand rch_pregnancy_registration_det.state = ''DELIVERY_DONE''\n--\tgroup by imt_member.id, rch_immunisation_master.immunisation_given\n--) as t where t.member_id = imt_member.id;\n\n\nwith rows as (\nINSERT INTO rch_pregnancy_registration_det(\n            member_id, family_id, lmp_date, edd, reg_date, state,location_id,current_location_id, created_on, \n            created_by, modified_on, modified_by)\n    VALUES (#member_id#, #family_id#, ''#last_lmp_date#'', ''#edd#'', ''#service_date#'', ''PENDING'', #location_id#, #location_id# ,now(), \n            #created_by#, now(), #created_by#) RETURNING id\n)\n\n\tupdate imt_member set is_pregnant = true, edd =  ''#edd#'', \n\tearly_registration = (to_date(''#last_lmp_date#'', ''MM/DD/YYYY'') + INTERVAL ''84 days'') >= to_date(''#service_date#'', ''MM/DD/YYYY'') , \n\tcur_preg_reg_det_id = (select id from rows),\n\tcur_preg_reg_date=''#service_date#'',\n\tanc_visit_dates = null,\n\timmunisation_given = null,\n\tmodified_by = ''#created_by#'', modified_on = now()\n\twhere id= #member_id#","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,family_id,edd,service_date,last_lmp_date,created_by,location_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"112fbaf9-9f82-4b38-9a12-d3a06a31dd33","type":"QUERY","template":"update event_mobile_notification_pending set ref_code = (select cur_preg_reg_det_id from imt_member where id = ''#member_id#'') where member_id = ''#member_id#'' and state = ''PENDING'' and ref_code=-1;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"8c06b081-964e-4bba-ba2d-3e349a644652","type":"QUERY","template":"update techo_notification_master set state = ''MARK_AS_PREGNANT'' where member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE'') and notification_type_id = (select id from notification_type_master where code = ''LMPFU'')","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"a7b9413a-f112-4180-bb13-ea60f1054b5e","type":"QUERY","template":"update techo_notification_master set ref_code = (select cur_preg_reg_det_id from imt_member where id = #member_id#)\nwhere member_id = #member_id# and state in (''PENDING'') and \nnotification_type_id in (select id from notification_type_master where code in (''FHW_ANC'',''FHW_WPD''));","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#lmp_date#'' !== ''null'' && #is_pregnant# == false && (''#last_method_of_contraception#'' == ''null'' || (''#last_method_of_contraception#'' != ''MLSTR'' && ''#last_method_of_contraception#'' != ''FMLSTR''))","conditionParam":"lmp_date,is_pregnant,last_method_of_contraception","description":null,"notificaitonConfigsType":[{"id":"578fc23c-b2fe-4172-b127-8bb1d9192cbb","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":"generate_lmp_followup","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#last_method_of_contraception#'' != ''null'' && (''#last_method_of_contraception#'' == ''MLSTR'' || ''#last_method_of_contraception#'' == ''FMLSTR'') && ''#to_generate_lmp_visit#''","conditionParam":"to_generate_lmp_visit,last_method_of_contraception","description":null,"notificaitonConfigsType":[{"id":"aa4f85aa-3043-48c9-8d04-e4093abff918","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":"generate_lmp_followup","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#member_status#'' == ''AVAILABLE'' && ''#lmp_date#'' == ''null'' && (''#is_pregnant#'' == ''null'' || #is_pregnant# == false) && ''#notification_code#'' == ''1''","conditionParam":"lmp_date,is_pregnant,member_status,notification_code","description":null,"notificaitonConfigsType":[{"id":"68539887-b180-4461-b418-ddac0470d653","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"0214a9cd-f111-452a-bc81-8408cc5f03b4","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"eventConfigUUID":null,"queryMasterId":null,"queryCode":"generate_lmp_followup","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_schedule_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]}],"status":null,"completionTime":null,"configJson":null,"uuid":"fd52fb4e-aa72-41a9-ae33-f507b7022709"}',  current_date , 1027, 'fd52fb4e-aa72-41a9-ae33-f507b7022709', 'LMP Followup');